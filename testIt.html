<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrankPort Music Player - Audiomack Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <script>
        class FrankPortMusicPlayer {
            constructor() {
                this.isMinimized = false;
                this.isCommentsOpen = false;
                this.isDragging = false;
                this.dragOffset = { x: 0, y: 0 };
                this.commentCount = 0;
                this.comments = [];
                
                this.floatingButton = null;
                this.musicCard = null;
                this.commentsSection = null;
                this.loadingOverlay = null;
                
                this.init();
            }

            init() {
                this.injectStyles();
                this.createFloatingButton();
                this.createMusicCard();
                this.setupEventListeners();
                this.loadCommentsFromStorage();
                this.requestAudioPermission();
            }

            injectStyles() {
                const styles = `
                    :root {
                        --primary-navy: #0D0D0D;
                        --admin-bg: #191919;
                        --admin-light-bg: #1c1c1c;
                        --accent-gold: #ffa200;
                        --text-primary: #ffffff;
                        --text-secondary: #b8bcc8;
                        --text-muted: #6c7293;
                        --border-color: #2d3142;
                    }

                    .frankport-music-floating-btn {
                        position: fixed;
                        bottom: 20px;
                        left: 20px;
                        width: 50px;
                        height: 50px;
                        background: var(--accent-gold);
                        border: none;
                        border-radius: 50%;
                        cursor: pointer;
                        font-size: 20px;
                        color: #000;
                        z-index: 9998;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 15px rgba(255, 162, 0, 0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: musicPulse 2s infinite;
                    }

                    .frankport-music-floating-btn:hover {
                        transform: scale(1.1);
                        box-shadow: 0 6px 20px rgba(255, 162, 0, 0.4);
                    }

                    .frankport-music-floating-btn::after {
                        content: attr(data-tooltip);
                        position: absolute;
                        bottom: 10px;
                        left: 60px;
                        background: var(--admin-bg);
                        color: var(--text-primary);
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        white-space: nowrap;
                        opacity: 0;
                        pointer-events: none;
                        transition: opacity 0.3s;
                        border: 1px solid var(--border-color);
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    }

                    .frankport-music-floating-btn::before {
                        content: '';
                        position: absolute;
                        bottom: 18px;
                        left: 52px;
                        width: 0;
                        height: 0;
                        border-top: 6px solid transparent;
                        border-bottom: 6px solid transparent;
                        border-right: 8px solid var(--admin-bg);
                        opacity: 0;
                        pointer-events: none;
                        transition: opacity 0.3s;
                    }

                    .frankport-music-floating-btn:hover::after,
                    .frankport-music-floating-btn:hover::before {
                        opacity: 1;
                    }

                    @keyframes musicPulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                    }

                    .frankport-music-card {
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        width: 400px;
                        height: 450px;
                        background: var(--admin-bg);
                        border-radius: 12px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 3px 10px rgba(0,0,0,0.1);
                        border: 1px solid rgba(255,255,255,0.2);
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        z-index: 9999;
                        cursor: move;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        overflow: hidden;
                        user-select: none;
                        display: none;
                        flex-direction: column;
                    }

                    .frankport-music-card.minimized {
                        width: 280px;
                        height: 380px;
                    }

                    .frankport-music-card.comments-open {
                        width: 600px;
                        flex-direction: row;
                    }

                    .main-content {
                        display: flex;
                        flex-direction: column;
                        flex: 1;
                        transition: all 0.3s ease;
                    }

                    .frankport-music-card.comments-open .main-content {
                        width: 360px;
                        flex: none;
                    }

                    .music-header {
                        display: flex;
                        align-items: center;
                        padding: 12px;
                        gap: 10px;
                        border-bottom: 1px solid rgba(255,255,255,0.1);
                        flex-shrink: 0;
                        background: var(--admin-light-bg);
                    }

                    .frankport-music-card.comments-open .music-header {
                        border-right: 1px solid rgba(255,255,255,0.1);
                    }

                    .album-art {
                        width: 40px;
                        height: 40px;
                        background: var(--admin-bg);
                        border-radius: 6px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: var(--accent-gold);
                        font-size: 16px;
                        flex-shrink: 0;
                        border: 1px solid var(--border-color);
                    }

                    .track-info {
                        flex: 1;
                        min-width: 0;
                    }

                    .track-title {
                        font-size: 13px;
                        font-weight: 600;
                        color: var(--text-primary);
                        margin: 0 0 2px 0;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }

                    .track-artist {
                        font-size: 11px;
                        color: var(--text-muted);
                        margin: 0;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }

                    .header-controls {
                        display: flex;
                        gap: 8px;
                        flex-shrink: 0;
                    }

                    .control-btn {
                        background: none;
                        border: none;
                        cursor: pointer;
                        padding: 6px;
                        border-radius: 6px;
                        color: var(--text-muted);
                        font-size: 14px;
                        transition: all 0.2s;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        min-width: 24px;
                        height: 24px;
                        position: relative;
                    }

                    .control-btn:hover {
                        background: rgba(255,255,255,0.1);
                        color: var(--text-primary);
                        transform: scale(1.05);
                    }

                    .control-btn.active {
                        color: var(--accent-gold);
                        background: rgba(255, 162, 0, 0.1);
                    }

                    .comment-badge {
                        position: absolute;
                        top: -2px;
                        right: -6px;
                        background: var(--accent-gold);
                        color: #000;
                        font-size: 9px;
                        padding: 1px 5px;
                        border-radius: 10px;
                        min-width: 14px;
                        text-align: center;
                        font-weight: 600;
                        line-height: 1.2;
                        display: none;
                    }

                    .card-control-btn {
                        background: var(--admin-bg);
                        border: none;
                        width: 20px;
                        height: 18px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 10px;
                        color: var(--text-muted);
                        transition: all 0.2s;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }

                    .card-control-btn:hover {
                        background: var(--accent-gold);
                        color: #000;
                    }

                    .desktop-only {
                        display: flex;
                    }

                    .audiomack-container {
                        width: 100%;
                        height: 388px;
                        background: var(--admin-light-bg);
                        border-radius: 0;
                        overflow: hidden;
                        position: relative;
                        transition: all 0.3s ease;
                    }

                    .frankport-music-card.comments-open .audiomack-container {
                        height: 388px;
                    }

                    .frankport-music-card.minimized .audiomack-container {
                        height: 318px;
                    }

                    .audiomack-container iframe {
                        width: 100%;
                        height: 100%;
                        border: none;
                        background: transparent;
                    }

                    .loading-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(25, 25, 25, 0.95);
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        z-index: 10;
                        backdrop-filter: blur(5px);
                        transition: opacity 0.3s ease;
                    }

                    .loading-spinner {
                        width: 40px;
                        height: 40px;
                        margin-bottom: 15px;
                        position: relative;
                    }

                    .loading-spinner::before {
                        content: 'ðŸŽµ';
                        font-size: 30px;
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        animation: musicSpin 1.5s linear infinite;
                    }

                    .loading-spinner::after {
                        content: '';
                        width: 100%;
                        height: 100%;
                        border: 3px solid rgba(255, 162, 0, 0.2);
                        border-top: 3px solid var(--accent-gold);
                        border-radius: 50%;
                        position: absolute;
                        animation: spin 1s linear infinite;
                    }

                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }

                    @keyframes musicSpin {
                        0% { transform: translate(-50%, -50%) rotate(0deg); }
                        100% { transform: translate(-50%, -50%) rotate(360deg); }
                    }

                    .loading-text {
                        color: var(--text-primary);
                        font-size: 14px;
                        font-weight: 600;
                        margin-bottom: 5px;
                    }

                    .loading-subtext {
                        color: var(--text-muted);
                        font-size: 11px;
                    }

                    .comments-section {
                        width: 240px;
                        height: 100%;
                        background: var(--admin-bg);
                        border-left: 1px solid rgba(255,255,255,0.1);
                        display: none;
                        flex-direction: column;
                        flex-shrink: 0;
                    }

                    .frankport-music-card.comments-open .comments-section {
                        display: flex;
                    }

                    .comments-header {
                        padding: 12px;
                        border-bottom: 1px solid rgba(255,255,255,0.1);
                        background: var(--admin-light-bg);
                        flex-shrink: 0;
                    }

                    .comments-title {
                        font-size: 13px;
                        font-weight: 600;
                        color: var(--text-primary);
                        margin: 0;
                    }

                    .comments-list {
                        flex: 1;
                        overflow-y: auto;
                        padding: 8px 12px;
                        min-height: 0;
                    }

                    .comment-item {
                        margin-bottom: 12px;
                        padding: 8px;
                        background: var(--admin-light-bg);
                        border-radius: 8px;
                        border-left: 3px solid var(--accent-gold);
                    }

                    .comment-text {
                        font-size: 11px;
                        color: var(--text-secondary);
                        margin: 0 0 4px 0;
                        line-height: 1.4;
                        word-wrap: break-word;
                    }

                    .comment-meta {
                        font-size: 9px;
                        color: var(--text-muted);
                        margin: 0;
                    }

                    .comment-input-area {
                        padding: 12px;
                        border-top: 1px solid rgba(255,255,255,0.1);
                        background: var(--admin-light-bg);
                        flex-shrink: 0;
                    }

                    .comment-input {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid var(--border-color);
                        border-radius: 6px;
                        font-size: 11px;
                        resize: none;
                        height: 40px;
                        font-family: inherit;
                        background: var(--admin-bg);
                        color: var(--text-primary);
                        box-sizing: border-box;
                    }

                    .comment-input:focus {
                        outline: none;
                        border-color: var(--accent-gold);
                    }

                    .comment-input::placeholder {
                        color: var(--text-muted);
                    }

                    .comment-submit {
                        margin-top: 6px;
                        width: 100%;
                        padding: 6px;
                        background: var(--accent-gold);
                        color: #000;
                        border: none;
                        border-radius: 6px;
                        font-size: 11px;
                        cursor: pointer;
                        transition: all 0.2s;
                        font-weight: 600;
                    }

                    .comment-submit:hover {
                        background: #e68900;
                        transform: translateY(-1px);
                    }

                    .no-comments {
                        text-align: center;
                        padding: 20px 10px;
                        color: var(--text-muted);
                        font-size: 11px;
                        line-height: 1.4;
                    }

                    .no-comments i {
                        font-size: 20px;
                        margin-bottom: 8px;
                        display: block;
                        color: var(--text-muted);
                    }

                    /* Mobile responsiveness */
                    @media (max-width: 768px) {
                        .frankport-music-card {
                            width: 320px;
                            height: 400px;
                            bottom: 15px;
                            right: 15px;
                        }

                        .frankport-music-card.comments-open {
                            width: 320px;
                            height: 100vh;
                            bottom: 0;
                            right: 0;
                            border-radius: 12px 12px 0 0;
                        }

                        .frankport-music-card.comments-open .main-content {
                            width: 100%;
                            height: 50%;
                        }

                        .frankport-music-card.comments-open .comments-section {
                            width: 100%;
                            height: 50%;
                            border-left: none;
                            border-top: 1px solid rgba(255,255,255,0.1);
                        }

                        .desktop-only {
                            display: none;
                        }

                        .audiomack-container {
                            height: 338px;
                        }

                        .frankport-music-card.minimized .audiomack-container {
                            height: 338px;
                        }
                    }

                    /* Scrollbar styling */
                    .comments-list::-webkit-scrollbar {
                        width: 6px;
                    }

                    .comments-list::-webkit-scrollbar-track {
                        background: var(--admin-bg);
                    }

                    .comments-list::-webkit-scrollbar-thumb {
                        background: var(--border-color);
                        border-radius: 3px;
                    }

                    .comments-list::-webkit-scrollbar-thumb:hover {
                        background: var(--accent-gold);
                    }
                `;

                const styleSheet = document.createElement('style');
                styleSheet.textContent = styles;
                document.head.appendChild(styleSheet);
            }

            createFloatingButton() {
                const button = document.createElement('button');
                button.className = 'frankport-music-floating-btn';
                button.innerHTML = '<i class="fas fa-music"></i>';
                button.setAttribute('data-tooltip', 'Listen to Ryan\'s Best Songs - Streaming Live from Audiomack');
                
                document.body.appendChild(button);
                this.floatingButton = button;
            }

            createMusicCard() {
                const card = document.createElement('div');
                card.className = 'frankport-music-card';
                card.innerHTML = `
                    <div class="main-content">
                        <div class="music-header">
                            <div class="album-art">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="track-info">
                                <h4 class="track-title">BEST SONGS ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥</h4>
                                <p class="track-artist">Ryan Artist</p>
                            </div>
                            <div class="header-controls">
                                <button class="control-btn comments-btn" title="Comments">
                                    <i class="far fa-comment"></i>
                                    <span class="comment-badge">0</span>
                                </button>
                                <button class="control-btn card-control-btn minimize-btn desktop-only" title="Minimize">
                                    <i class="fas fa-compress"></i>
                                </button>
                                <button class="control-btn card-control-btn maximize-btn desktop-only" title="Maximize" style="display: none;">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="control-btn card-control-btn close-btn" title="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="audiomack-container">
                            <div class="loading-overlay">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">Getting your music ready...</div>
                                <div class="loading-subtext">Connecting to Audiomack</div>
                            </div>
                            <iframe 
                                src="https://audiomack.com/embed/ryan-artist/playlist/best-songs" 
                                scrolling="no" 
                                title="BEST SONGS ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥"
                                allow="autoplay; encrypted-media">
                            </iframe>
                        </div>
                    </div>
                    
                    <div class="comments-section">
                        <div class="comments-header">
                            <h3 class="comments-title">Comments</h3>
                        </div>
                        <div class="comments-list"></div>
                        <div class="comment-input-area">
                            <textarea class="comment-input" placeholder="Share your thoughts about this playlist..." maxlength="200"></textarea>
                            <button class="comment-submit">Post Comment</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(card);
                this.musicCard = card;
                this.commentsSection = card.querySelector('.comments-section');
                this.loadingOverlay = card.querySelector('.loading-overlay');
            }

            setupEventListeners() {
                // Floating button
                this.floatingButton.addEventListener('click', () => {
                    this.showMusicCard();
                });

                // Card controls
                this.musicCard.querySelector('.close-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.hideMusicCard();
                });

                this.musicCard.querySelector('.minimize-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.minimizeCard();
                });

                this.musicCard.querySelector('.maximize-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.maximizeCard();
                });

                this.musicCard.querySelector('.comments-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleComments();
                });

                // Comment functionality
                this.musicCard.querySelector('.comment-submit').addEventListener('click', () => {
                    this.submitComment();
                });

                this.musicCard.querySelector('.comment-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.submitComment();
                    }
                });

                // Loading management
                this.setupLoadingManagement();

                // Dragging functionality
                this.setupDragging();

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'm') {
                        e.preventDefault();
                        if (this.musicCard.style.display === 'none' || this.musicCard.style.display === '') {
                            this.showMusicCard();
                        } else {
                            this.hideMusicCard();
                        }
                    }
                });
            }

            setupLoadingManagement() {
                const iframe = this.musicCard.querySelector('iframe');
                const messages = [
                    'Getting your music ready...',
                    'Loading playlist...',
                    'Connecting to Audiomack...',
                    'Almost there, preparing your songs...'
                ];

                // Show loading on iframe load start
                iframe.addEventListener('loadstart', () => {
                    this.showLoading(messages[Math.floor(Math.random() * messages.length)]);
                });

                // Hide loading when iframe loads
                iframe.addEventListener('load', () => {
                    setTimeout(() => this.hideLoading(), 1500);
                });

                // Fallback: Auto-hide loading after timeout
                setTimeout(() => {
                    if (this.loadingOverlay && this.loadingOverlay.style.display !== 'none') {
                        this.hideLoading();
                    }
                }, 5000);

                // Periodic check for potential loading states
                setInterval(() => {
                    if (this.musicCard.style.display !== 'none') {
                        this.checkForLoadingStates();
                    }
                }, 10000);
            }

            showLoading(message = 'Loading your music...') {
                if (this.loadingOverlay) {
                    this.loadingOverlay.querySelector('.loading-text').textContent = message;
                    this.loadingOverlay.style.display = 'flex';
                }
            }

            hideLoading() {
                if (this.loadingOverlay) {
                    this.loadingOverlay.style.opacity = '0';
                    setTimeout(() => {
                        this.loadingOverlay.style.display = 'none';
                        this.loadingOverlay.style.opacity = '1';
                    }, 300);
                }
            }

            checkForLoadingStates() {
                // Simple heuristic: if user might be experiencing delays
                if (Math.random() < 0.1) { // 10% chance every 10 seconds
                    this.showLoading('Refreshing connection...');
                    setTimeout(() => this.hideLoading(), 2000);
                }
            }

            setupDragging() {
                this.musicCard.addEventListener('mousedown', (e) => {
                    if (e.target.closest('.control-btn') || 
                        e.target.closest('.card-control-btn') ||
                        e.target.closest('iframe') ||
                        e.target.closest('.comments-section')) return;
                    
                    this.isDragging = true;
                    const rect = this.musicCard.getBoundingClientRect();
                    this.dragOffset = {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                    
                    document.addEventListener('mousemove', this.handleDrag.bind(this));
                    document.addEventListener('mouseup', this.handleDragEnd.bind(this));
                    
                    this.musicCard.style.cursor = 'grabbing';
                    e.preventDefault();
                });
            }

            handleDrag(e) {
                if (!this.isDragging) return;
                
                const x = e.clientX - this.dragOffset.x;
                const y = e.clientY - this.dragOffset.y;
                
                const maxX = window.innerWidth - this.musicCard.offsetWidth;
                const maxY = window.innerHeight - this.musicCard.offsetHeight;
                
                const constrainedX = Math.max(0, Math.min(x, maxX));
                const constrainedY = Math.max(0, Math.min(y, maxY));
                
                this.musicCard.style.left = constrainedX + 'px';
                this.musicCard.style.top = constrainedY + 'px';
                this.musicCard.style.right = 'auto';
                this.musicCard.style.bottom = 'auto';
            }

            handleDragEnd() {
                this.isDragging = false;
                this.musicCard.style.cursor = 'move';
                document.removeEventListener('mousemove', this.handleDrag);
                document.removeEventListener('mouseup', this.handleDragEnd);
            }

            showMusicCard() {
                this.musicCard.style.display = 'flex';
                this.floatingButton.style.display = 'none';
                this.showLoading('Loading your music...');
            }

            hideMusicCard() {
                this.musicCard.style.display = 'none';
                this.floatingButton.style.display = 'flex';
                if (this.isCommentsOpen) {
                    this.toggleComments();
                }
            }

            minimizeCard() {
                this.isMinimized = true;
                this.musicCard.classList.add('minimized');
                this.musicCard.querySelector('.minimize-btn').style.display = 'none';
                this.musicCard.querySelector('.maximize-btn').style.display = 'flex';
                
                if (this.isCommentsOpen) {
                    this.toggleComments();
                }
            }

            maximizeCard() {
                this.isMinimized = false;
                this.musicCard.classList.remove('minimized');
                this.musicCard.querySelector('.minimize-btn').style.display = 'flex';
                this.musicCard.querySelector('.maximize-btn').style.display = 'none';
            }

            toggleComments() {
                this.isCommentsOpen = !this.isCommentsOpen;
                this.musicCard.classList.toggle('comments-open', this.isCommentsOpen);
                this.musicCard.querySelector('.comments-btn').classList.toggle('active', this.isCommentsOpen);
                
                if (this.isCommentsOpen) {
                    this.renderComments();
                    // Adjust position if card would exceed screen width
                    this.adjustPositionForComments();
                }
            }

            adjustPositionForComments() {
                if (window.innerWidth > 768) { // Desktop only
                    const rect = this.musicCard.getBoundingClientRect();
                    const cardWidth = this.isCommentsOpen ? 600 : 400;
                    
                    if (rect.right > window.innerWidth - 20) {
                        const newLeft = window.innerWidth - cardWidth - 20;
                        this.musicCard.style.left = Math.max(20, newLeft) + 'px';
                        this.musicCard.style.right = 'auto';
                    }
                }
            }

            submitComment() {
                const input = this.musicCard.querySelector('.comment-input');
                const text = input.value.trim();
                
                if (text && text.length > 0) {
                    const comment = {
                        text: text,
                        timestamp: Date.now(),
                        author: 'Anonymous'
                    };
                    
                    this.comments.unshift(comment);
                    this.commentCount++;
                    this.updateCommentCounter();
                    this.saveCommentsToStorage();
                    this.renderComments();
                    input.value = '';
                }
            }

            renderComments() {
                const commentsList = this.musicCard.querySelector('.comments-list');
                
                if (this.comments.length === 0) {
                    commentsList.innerHTML = `
                        <div class="no-comments">
                            <i class="far fa-comment"></i>
                            No comments yet. Be the first to share your thoughts about this playlist!
                        </div>
                    `;
                    return;
                }
                
                commentsList.innerHTML = this.comments.map(comment => {
                    const timeAgo = this.getTimeAgo(comment.timestamp);
                    return `
                        <div class="comment-item">
                            <p class="comment-text">${this.escapeHtml(comment.text)}</p>
                            <p class="comment-meta">${comment.author} â€¢ ${timeAgo}</p>
                        </div>
                    `;
                }).join('');
                
                commentsList.scrollTop = 0;
            }

            updateCommentCounter() {
                const badge = this.musicCard.querySelector('.comment-badge');
                badge.textContent = this.commentCount;
                badge.style.display = this.commentCount > 0 ? 'block' : 'none';
            }

            getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                if (minutes < 1) return 'just now';
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                return `${days}d ago`;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            saveCommentsToStorage() {
                try {
                    const data = {
                        comments: this.comments,
                        count: this.commentCount
                    };
                    localStorage.setItem('frankport-music-comments', JSON.stringify(data));
                } catch (e) {
                    window.frankportMusicComments = { comments: this.comments, count: this.commentCount };
                }
            }

            loadCommentsFromStorage() {
                try {
                    const stored = localStorage.getItem('frankport-music-comments') || 
                                  (window.frankportMusicComments ? JSON.stringify(window.frankportMusicComments) : null);
                    
                    if (stored) {
                        const data = JSON.parse(stored);
                        this.comments = data.comments || [];
                        this.commentCount = data.count || this.comments.length;
                        this.updateCommentCounter();
                    }
                } catch (e) {
                    this.comments = [];
                    this.commentCount = 0;
                }
            }

            requestAudioPermission() {
                // Create a user interaction prompt for audio autoplay
                if (!sessionStorage.getItem('frankport-audio-permission')) {
                    const notice = document.createElement('div');
                    notice.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: var(--admin-bg);
                        color: var(--text-primary);
                        padding: 12px 20px;
                        border-radius: 8px;
                        border: 1px solid var(--border-color);
                        z-index: 10000;
                        font-size: 12px;
                        max-width: 300px;
                        text-align: center;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    `;
                    notice.innerHTML = `
                        ðŸŽµ Click anywhere to enable audio playback
                        <button style="margin-left: 10px; background: var(--accent-gold); color: #000; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">OK</button>
                    `;
                    
                    const enableAudio = () => {
                        sessionStorage.setItem('frankport-audio-permission', 'true');
                        notice.remove();
                        document.removeEventListener('click', enableAudio);
                    };
                    
                    notice.querySelector('button').addEventListener('click', enableAudio);
                    document.addEventListener('click', enableAudio);
                    document.body.appendChild(notice);
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.frankportMusicPlayer = new FrankPortMusicPlayer();
            console.log('ðŸŽµ FrankPort Music Player - Ready!');
        });
    </script>
 </body>
</html>